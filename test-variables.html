<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Pointrel In JavaScript text-variables</title>
    <script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>

    <script type="text/javascript" src="js/sha256.js"></script>
    <script type="text/javascript" src="js/utils_common.js"></script>
    <script type="text/javascript" src="js/jstorage.js"></script>
    <script type="text/javascript" src="js/pointrel_authentication.js"></script>
    <script type="text/javascript" src="js/pointrel20130202ForJQuery.js"></script>
</head>
<body>
<h3>Test resources</h3>
This tests Pointrel functionality for creating, getting, updating, and deleting a variable from a web server using
JavaScript.
JavaScript must be enabled for this page for this test to work.
Click here to test the back-end script with no data:
<a href="server/variable-query.php">test variable query</a>.
<p></p>
ERROR
<div id="errorcontainer"></div>
<BR>
QUERY
<div id="query"></div>
<BR>
RESPONSE
<div id="response"></div>
<BR>
RETRIEVE
<div id="retrieve"></div>
<BR>

<script type="text/javascript">
    var variableName = "test-of-variable-changes";

    var sampleURI1 = "pointrel://sha256_2e99758548972a8e8822ad47fa1017ff72f06f3ff6a016851f45c398732bc50c_14.txt";
    var sampleURI2 = "pointrel://sha256_2e99758548972a8e8822ad47fa1017ff72f06f3ff6a016851f45c398732bc50c_14.dat";

    $(document).ready(function () {
        newTest();
    });

    function newTest() {
        pointrel_variable_new(variableName, sampleURI1, function (error, data) {
            document.getElementById("errorcontainer").innerHTML = JSON.stringify(error);
            document.getElementById("response").innerHTML = JSON.stringify(data);
            if (data.status == "OK") retrieveTest();
        });

        document.getElementById("query").innerHTML = "Waiting... on new: " + variableName + " setting to: " + sampleURI1;
    }

    function retrieveTest() {
        pointrel_variable_get(variableName, function (error, data) {
            document.getElementById("errorcontainer").innerHTML = JSON.stringify(error);
            document.getElementById("response").innerHTML = JSON.stringify(data);
            if (data.status == "OK") updateTest();
        });

        document.getElementById("query").innerHTML = "Waiting... on get: " + variableName;
    }


    function updateTest() {
        pointrel_variable_set(variableName, sampleURI1, sampleURI2, function (error, data) {
            document.getElementById("errorcontainer").innerHTML = JSON.stringify(error);
            document.getElementById("response").innerHTML = JSON.stringify(data);
            if (data.status == "OK") deleteTest();
        });

        document.getElementById("query").innerHTML = "Waiting... on set: " + variableName;
    }

    function deleteTest() {
        pointrel_variable_delete(variableName, sampleURI2, function (error, data) {
            document.getElementById("errorcontainer").innerHTML = JSON.stringify(error);
            document.getElementById("response").innerHTML = JSON.stringify(data);
           if (data.status == "OK") done();
        });

        document.getElementById("query").innerHTML = "Waiting... on set: " + variableName;
    }

    function done() {
        document.getElementById("query").innerHTML = "Done";
    }

</script>

</body>
</html>